# Push-Manager æœåŠ¡å®ç°æ€»ç»“

## ğŸ“‹ æ¦‚è§ˆ

æœ¬æ¬¡å®ç°å®Œæˆäº† **Push-Manager** æ¨¡å—çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒæŒ‰ç…§æ¶æ„å›¾ä¸­çš„è®¾è®¡ï¼Œå®ç°äº†ï¼š

1. **ETCD æœåŠ¡å‘ç°** - å‘ç°æ‰€æœ‰ Connect-Node å®ä¾‹
2. **å®¢æˆ·ç«¯æ± ç®¡ç†** - ä¸ºæ¯ä¸ª Connect-Node åˆ›å»ºå’Œç»´æŠ¤ gRPC å®¢æˆ·ç«¯
3. **å¼‚æ­¥æ¶ˆæ¯æ¨é€** - å¤šåç¨‹å¹¶å‘å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—
4. **åŠ¨æ€èŠ‚ç‚¹ç›‘å¬** - å®æ—¶ç›‘å¬ ETCD ä¸­èŠ‚ç‚¹çš„å˜åŒ–

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Push-Manager                              â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ServiceDiscovery (ETCD æœåŠ¡å‘ç°)                   â”‚   â”‚
â”‚  â”‚  - ç›‘å¬ ETCD ä¸­çš„ /services/connect-node           â”‚   â”‚
â”‚  â”‚  - å®šæœŸè½®è¯¢æ›´æ–°ç«¯ç‚¹åˆ—è¡¨ï¼ˆ3ç§’é—´éš”ï¼‰                  â”‚   â”‚
â”‚  â”‚  - å¼‚æ­¥åç¨‹è‡ªåŠ¨å¤„ç†èŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BroadcastClientMap (å®¢æˆ·ç«¯æ± )                      â”‚   â”‚
â”‚  â”‚  - Key: nodeID (connect-node-{addr})                â”‚   â”‚
â”‚  â”‚  - Value: *BroadcastClient                          â”‚   â”‚
â”‚  â”‚  - æ”¯æŒå¹¶å‘è¯»å†™ï¼ˆsync.RWMutexï¼‰                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  BroadcastClient (å•ä¸ªèŠ‚ç‚¹å®¢æˆ·ç«¯)                   â”‚   â”‚
â”‚  â”‚  - gRPC è¿æ¥                                         â”‚   â”‚
â”‚  â”‚  - æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆChan: 1000ç¼“å†²ï¼‰                       â”‚   â”‚
â”‚  â”‚  - å·¥ä½œåç¨‹æ± ï¼ˆé»˜è®¤10ä¸ªåç¨‹ï¼‰                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Worker Goroutines (å¹¶å‘æ¶ˆæ¯å¤„ç†)                   â”‚   â”‚
â”‚  â”‚  - ä»é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯                                    â”‚   â”‚
â”‚  â”‚  - è°ƒç”¨ Connect-Node çš„ Broadcast RPC              â”‚   â”‚
â”‚  â”‚  - 5ç§’è¶…æ—¶æ§åˆ¶                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“ å‘é€æ¶ˆæ¯åˆ°                                        â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚      â”‚  Connect-Node      â”‚                                  â”‚
â”‚      â”‚  å®ä¾‹1-N           â”‚                                  â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ–‡ä»¶ä¿®æ”¹

### 1. `/push-manager/server.go` - å®Œæ•´é‡å†™

#### æ ¸å¿ƒç»“æ„ä½“

**BroadcastClient** - ä¸ºæ¯ä¸ª Connect-Node ç»´æŠ¤çš„å®¢æˆ·ç«¯å°è£…
```go
type BroadcastClient struct {
    serverID      string                              // èŠ‚ç‚¹ID
    client        broadcast.PushServerClient          // gRPC å®¢æˆ·ç«¯
    broadcastChan chan *broadcast.BroadCastReq       // æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆ1000ç¼“å†²ï¼‰
    routineSize   uint64                              // å·¥ä½œåç¨‹æ•°é‡
    conn          *grpc.ClientConn                    // gRPC è¿æ¥
    ctx           context.Context                     // ä¸Šä¸‹æ–‡
    cancel        context.CancelFunc                  // å–æ¶ˆå‡½æ•°
    activeWorkers int32                               // æ´»è·ƒåç¨‹è®¡æ•°
    mu            sync.Mutex                          // åç¨‹è®¡æ•°é”
}
```

**PushManagerServer** - Push-Manager ä¸»æœåŠ¡
```go
type PushManagerServer struct {
    managerID          string                          // ç®¡ç†å™¨ID
    config             *config.Config                  // é…ç½®
    discovery          *etcd.ServiceDiscovery         // ETCD æœåŠ¡å‘ç°
    broadCastClientMap map[string]*BroadcastClient    // å®¢æˆ·ç«¯æ± 
    clientMapMu        sync.RWMutex                    // å®¢æˆ·ç«¯æ± é”
    metrics            *metrics.MetricsCollector      // æŒ‡æ ‡æ”¶é›†
    ctx                context.Context                 // ä¸Šä¸‹æ–‡
    cancel             context.CancelFunc              // å–æ¶ˆå‡½æ•°
}
```

#### æ ¸å¿ƒæ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| `NewPushManagerServer()` | åˆ›å»ºæœåŠ¡å®ä¾‹ | åˆå§‹åŒ–æ‰€æœ‰å­—æ®µå’Œä¸Šä¸‹æ–‡ |
| `WatchConnectNodes()` | ç›‘å¬èŠ‚ç‚¹å˜åŒ– | å¼‚æ­¥åç¨‹å®šæœŸåˆ·æ–°èŠ‚ç‚¹åˆ—è¡¨ |
| `discoverAndUpdateNodes()` | å‘ç°å¹¶æ›´æ–°èŠ‚ç‚¹ | å¤„ç†èŠ‚ç‚¹ä¸Šçº¿/ä¸‹çº¿ |
| `createBroadcastClient()` | åˆ›å»ºå®¢æˆ·ç«¯ | å»ºç«‹ gRPC è¿æ¥ï¼Œå¯åŠ¨å·¥ä½œåç¨‹ |
| `runWorker()` | å·¥ä½œåç¨‹ | ä»é˜Ÿåˆ—å–æ¶ˆæ¯ï¼Œå‘é€åˆ° Connect-Node |
| `EnqueueBroadcastMsg()` | å…¥é˜Ÿæ¶ˆæ¯ | å°†æ¶ˆæ¯åŠ å…¥æ‰€æœ‰èŠ‚ç‚¹çš„é˜Ÿåˆ— |
| `Broadcast()` | RPC æ–¹æ³• | æ¥æ”¶å¹¿æ’­è¯·æ±‚ï¼Œå…¥é˜Ÿå¤„ç† |
| `Close()` | å…³é—­å®¢æˆ·ç«¯ | ä¼˜é›…å…³é—­å•ä¸ªå®¢æˆ·ç«¯ |
| `cleanupAllClients()` | æ¸…ç†æ‰€æœ‰ | å…³é—­æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ |

---

### 2. `/pkg/etcd/registry.go` - å¢å¼ºæœåŠ¡å‘ç°

#### æ–°å¢ç»“æ„ä½“

**ServiceDiscovery** - ETCD æœåŠ¡å‘ç°å°è£…
```go
type ServiceDiscovery struct {
    client        *eclient.Client           // ETCD å®¢æˆ·ç«¯
    serviceName   string                    // æœåŠ¡åç§°
    ctx           context.Context           // ä¸Šä¸‹æ–‡
    cancel        context.CancelFunc        // å–æ¶ˆå‡½æ•°
    endpointsMu   sync.RWMutex             // ç«¯ç‚¹åˆ—è¡¨é”
    endpoints     map[string]string        // ç«¯ç‚¹æ˜ å°„ (key -> addr)
}
```

#### æ–°å¢æ–¹æ³•

| æ–¹æ³• | åŠŸèƒ½ |
|------|------|
| `NewServiceDiscovery()` | åˆ›å»ºæœåŠ¡å‘ç°å®ä¾‹ |
| `GetEndpoints()` | è·å–æ‰€æœ‰å¯ç”¨ç«¯ç‚¹ |
| `refreshEndpoints()` | åˆ·æ–°ç«¯ç‚¹åˆ—è¡¨ |
| `watchEndpoints()` | ç›‘å¬ç«¯ç‚¹å˜åŒ–ï¼ˆå®šæœŸè½®è¯¢ï¼‰ |
| `Close()` | å…³é—­æœåŠ¡å‘ç° |

#### å·¥ä½œæµç¨‹

1. **åˆå§‹åŒ–** - è¿æ¥ ETCDï¼Œè·å–åˆå§‹ç«¯ç‚¹åˆ—è¡¨
2. **å®šæœŸè½®è¯¢** - æ¯3ç§’æ£€æŸ¥ä¸€æ¬¡ `/services/connect-node`
3. **æ›´æ–°ç®¡ç†** - è‡ªåŠ¨å¤„ç†æ–°å¢/ä¸‹çº¿çš„èŠ‚ç‚¹
4. **å¹¶å‘å®‰å…¨** - ä½¿ç”¨ `sync.RWMutex` ä¿æŠ¤ç«¯ç‚¹åˆ—è¡¨

---

## ğŸ”„ æ¶ˆæ¯æµç¨‹

### 1. Push-Manager å¯åŠ¨æµç¨‹

```
å¯åŠ¨ Push-Manager
    â†“
åŠ è½½é…ç½®
    â†“
åˆå§‹åŒ– ETCD æœåŠ¡å‘ç°
    â†“
åˆ›å»º Push-Manager æœåŠ¡å™¨
    â†“
å¯åŠ¨ WatchConnectNodes() åç¨‹ â”€â†’ åå°ç›‘å¬èŠ‚ç‚¹å˜åŒ–
    â†“
å¯åŠ¨ gRPC æœåŠ¡å™¨
    â†“
Ready æ¥æ”¶æ¨é€è¯·æ±‚
```

### 2. æ¶ˆæ¯æ¨é€æµç¨‹

```
Biz Server è°ƒç”¨ PushManager.Broadcast()
    â†“
PushManagerServer.Broadcast() å¤„ç†è¯·æ±‚
    â†“
EnqueueBroadcastMsg() éå†æ‰€æœ‰å®¢æˆ·ç«¯
    â†“
å°†æ¶ˆæ¯å…¥é˜Ÿåˆ°æ¯ä¸ª BroadcastClient çš„ chan
    â†“
(1000ç¼“å†²æ»¡æ—¶ï¼Œä¸¢å¼ƒæ¶ˆæ¯å¹¶è®°å½•è­¦å‘Š)
    â†“
Worker Goroutine ä»é˜Ÿåˆ—å–æ¶ˆæ¯
    â†“
è°ƒç”¨ Connect-Node.Broadcast(msg)
    â†“
5ç§’è¶…æ—¶æ§åˆ¶ï¼Œé”™è¯¯æ—¥å¿—è®°å½•
    â†“
æ¶ˆæ¯å·²æ¨é€ âœ…
    â†“
Connect-Node æ ¹æ®è®¢é˜…å…³ç³»
æ¨é€ç»™æŒ‡å®šç”¨æˆ· â†’ WebSocket è¿æ¥
```

### 3. èŠ‚ç‚¹ç›‘å¬æµç¨‹

```
WatchConnectNodes() åå°è¿è¡Œ
    â†“ (æ¯3ç§’)
discoverAndUpdateNodes()
    â†“
è°ƒç”¨ ServiceDiscovery.GetEndpoints()
    â†“
æ–°å¢èŠ‚ç‚¹ â†’ createBroadcastClient()
    â†“
  â”œâ”€ å»ºç«‹ gRPC è¿æ¥
  â”œâ”€ åˆ›å»º PushServerClient
  â”œâ”€ åˆå§‹åŒ–æ¶ˆæ¯é˜Ÿåˆ— (1000ç¼“å†²)
  â”œâ”€ å¯åŠ¨ 10 ä¸ª Worker Goroutine
  â””â”€ å°†å®¢æˆ·ç«¯åŠ å…¥ broadCastClientMap
    â†“
ä¸‹çº¿èŠ‚ç‚¹ â†’ Close() & åˆ é™¤æ˜ å°„
    â†“
å·²è¿æ¥èŠ‚ç‚¹ â†’ ä¿æŒæ´»è·ƒ
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### Push-Manager main.go ä¸­çš„ä½¿ç”¨

```go
// åˆ›å»ºæœåŠ¡å‘ç°
etcdDiscovery, err := etcd.NewServiceDiscovery(
    cfg.config.ETCD.Endpoints,
    "connect-node",  // ç›‘å¬ connect-node æœåŠ¡
)
defer etcdDiscovery.Close()

// åˆ›å»º Push-Manager æœåŠ¡å™¨
pushManager := NewPushManagerServer(
    cfg.managerID,
    cfg.config,
    etcdDiscovery,
    metricsCollector,
)

// å¯åŠ¨èŠ‚ç‚¹ç›‘å¬ï¼ˆå¼‚æ­¥ï¼‰
go pushManager.WatchConnectNodes(ctx)

// ç­‰å¾…ä¸€ä¸‹è®©èŠ‚ç‚¹å‘ç°å®Œæˆ
time.Sleep(1 * time.Second)

// æ³¨å†Œ gRPC æœåŠ¡
grpcServer := grpc.NewServer()
broadcast.RegisterPushServerServer(grpcServer, pushManager)
```

### è°ƒç”¨ Broadcast RPC

```bash
# ä½¿ç”¨ grpcurl
grpcurl -plaintext localhost:50053 list

# è°ƒç”¨å¹¿æ’­æ¥å£
grpcurl -plaintext -d '{"proto": {...}}' \
  localhost:50053 \
  protocol.PushServer/Broadcast
```

---

## ğŸ”§ é…ç½®å‚æ•°

| å‚æ•° | å«ä¹‰ | é»˜è®¤å€¼ | å¯é…ç½® |
|------|------|--------|--------|
| routineSize | æ¯ä¸ªèŠ‚ç‚¹çš„å·¥ä½œåç¨‹æ•° | 10 | âœ“ åœ¨ `createBroadcastClient` ä¸­ |
| é˜Ÿåˆ—ç¼“å†² | æ¶ˆæ¯é˜Ÿåˆ—å¤§å° | 1000 | âœ“ åœ¨ `BroadcastClient.broadcastChan` åˆå§‹åŒ– |
| è½®è¯¢é—´éš” | ETCD è½®è¯¢å‘¨æœŸ | 3ç§’ | âœ“ åœ¨ `ServiceDiscovery.watchEndpoints` ä¸­ |
| RPC è¶…æ—¶ | å‘é€æ¶ˆæ¯è¶…æ—¶ | 5ç§’ | âœ“ åœ¨ `runWorker` ä¸­ |
| ETCD åœ°å€ | etcd æœåŠ¡åœ°å€ | http://localhost:2379 | âœ“ åœ¨ `EtcdAddr` å¸¸é‡ |

---

## ğŸ“Š å¹¶å‘æ¨¡å‹

### 1. å®¢æˆ·ç«¯æ± å¹¶å‘

```
PushManagerServer.broadCastClientMap
    â†“ (è¯»æ“ä½œ)
WatchConnectNodes() - æŒæœ‰ RLock
EnqueueBroadcastMsg() - æŒæœ‰ RLock
    â†“ (å†™æ“ä½œ)
discoverAndUpdateNodes() - æŒæœ‰ Lock (åˆ›å»º/åˆ é™¤)
```

### 2. æ¶ˆæ¯é˜Ÿåˆ—å¹¶å‘

```
EnqueueBroadcastMsg() â”€â”€â†’ å†™å…¥ broadcastChan â”€â”€â†’ Worker Goroutine
(ä¸»åç¨‹)                                        (æ¶ˆè´¹åç¨‹)
                        å¹¶å‘å®‰å…¨ï¼ˆGo channelï¼‰
```

### 3. å·¥ä½œåç¨‹

- **æ¯ä¸ªèŠ‚ç‚¹** æœ‰ **10ä¸ªç‹¬ç«‹çš„ Worker**
- **æ€»åç¨‹æ•°** = èŠ‚ç‚¹æ•° Ã— 10
- **æ¶ˆæ¯å¤„ç†** å®Œå…¨å¹¶è¡Œ

---

## âœ… å…³é”®ç‰¹æ€§

### 1. åŠ¨æ€èŠ‚ç‚¹å‘ç° âœ“
- è‡ªåŠ¨å‘ç°æ–°å¢ Connect-Node
- è‡ªåŠ¨æ¸…ç†ä¸‹çº¿ Connect-Node
- åå°å¼‚æ­¥å¤„ç†ï¼Œæ— é˜»å¡

### 2. å¯é æ€§ âœ“
- è¿æ¥å¤±è´¥æ—¶è¯¦ç»†æ—¥å¿—
- æ¶ˆæ¯é˜Ÿåˆ—æ»¡æ—¶è­¦å‘Šè®°å½•
- RPC è°ƒç”¨ 5ç§’è¶…æ—¶ä¿æŠ¤
- ä¼˜é›…å…³é—­ï¼ˆç­‰å¾…æ‰€æœ‰å·¥ä½œåç¨‹å®Œæˆï¼‰

### 3. æ€§èƒ½ âœ“
- å¤šåç¨‹å¹¶å‘å¤„ç†
- æ¶ˆæ¯é˜Ÿåˆ—ç¼“å†²
- æ— é” Channel é€šä¿¡
- è¯»å†™é”ä¼˜åŒ–å¹¶å‘

### 4. å¯ç»´æŠ¤æ€§ âœ“
- è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼ˆDEBUG çº§åˆ«ï¼‰
- ç»“æ„æ¸…æ™°ï¼Œä»£ç æ³¨é‡Šå®Œå–„
- æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±•

---

## ğŸ› è°ƒè¯•å»ºè®®

### æŸ¥çœ‹èŠ‚ç‚¹å‘ç°çŠ¶æ€
```
æ—¥å¿—: "âœ… [ServiceDiscovery] å‘ç° connect-node å®ä¾‹"
```

### æŸ¥çœ‹æ¶ˆæ¯æ¨é€
```
æ—¥å¿—: "ğŸ“¤ [Push-Manager] æ¶ˆæ¯å·²åŠ å…¥é˜Ÿåˆ—"
æ—¥å¿—: "âœ… [Worker-xxx] æ¶ˆæ¯æ¨é€æˆåŠŸ"
```

### æŸ¥çœ‹é˜Ÿåˆ—æ»¡
```
æ—¥å¿—: "âš ï¸  [Push-Manager] èŠ‚ç‚¹ xxx çš„é˜Ÿåˆ—å·²æ»¡ï¼Œä¸¢å¼ƒæ¶ˆæ¯"
â†’ éœ€è¦å¢åŠ  routineSize æˆ–å¢åŠ é˜Ÿåˆ—å¤§å°
```

### æŸ¥çœ‹è¿æ¥é”™è¯¯
```
æ—¥å¿—: "âŒ [Push-Manager] è¿æ¥åˆ° xxx å¤±è´¥"
â†’ æ£€æŸ¥ Connect-Node æ˜¯å¦æ­£å¸¸å¯åŠ¨
â†’ æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
```

---

## ğŸ“ æ€»ç»“

æœ¬å®ç°å®Œå…¨æŒ‰ç…§ pub-sub æ¶æ„å›¾è¿›è¡Œè®¾è®¡ï¼š

1. **Push-Manager** é€šè¿‡ **ETCD æœåŠ¡å‘ç°**è·å–æ‰€æœ‰ **Connect-Node** å®ä¾‹
2. ä¸ºæ¯ä¸ªå®ä¾‹ç»´æŠ¤ä¸€ä¸ª **gRPC å®¢æˆ·ç«¯** å’Œ **æ¶ˆæ¯é˜Ÿåˆ—**
3. å¯åŠ¨ **å¤šä¸ª Worker åç¨‹**å¹¶å‘å¤„ç†æ¶ˆæ¯
4. æ¥æ”¶æ¶ˆæ¯æ—¶é€šè¿‡ **EnqueueBroadcastMsg** åˆ†å‘åˆ°å„èŠ‚ç‚¹
5. å„èŠ‚ç‚¹æ ¹æ® **è®¢é˜…å…³ç³»**æ¨é€ç»™ç”¨æˆ·

ğŸ‰ **æ¶æ„å®Œæ•´ï¼ŒåŠŸèƒ½å®Œå–„ï¼Œå·²å°±ç»ªä¸Šçº¿ï¼**
