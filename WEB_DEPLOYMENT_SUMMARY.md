# âœ… Docker Compose + Web èŠå¤©å®¤é…ç½®å®Œæˆ

## ğŸ¯ å®Œæˆçš„å·¥ä½œ

### 1. æ·»åŠ äº† Biz-Server åˆ° Docker Compose
- åˆ›å»ºäº† `Dockerfile.biz-server`
- åœ¨ `docker-compose.yml` ä¸­æ·»åŠ äº† biz-server æœåŠ¡
- æš´éœ²ç«¯å£ï¼š8082

### 2. æ·»åŠ äº† Web Server åˆ° Docker Compose
- åˆ›å»ºäº† `Dockerfile.web`
- åœ¨ `docker-compose.yml` ä¸­æ·»åŠ äº† web-server æœåŠ¡
- æš´éœ²ç«¯å£ï¼š8086

### 3. åˆ›å»ºäº†ç¯å¢ƒé…ç½®åŒ–çš„ Web åº”ç”¨
- `web/config.js`: è‡ªåŠ¨æ£€æµ‹ç¯å¢ƒï¼ˆæœ¬åœ° vs Dockerï¼‰
- `web/chat.html`: ä½¿ç”¨é…ç½®æ–‡ä»¶çš„åœ°å€
- `web/main.go`: æ”¯æŒç¯å¢ƒå˜é‡é…ç½®ç«¯å£

### 4. åˆ›å»ºäº†è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£
- `DOCKER_DEPLOYMENT.md`: Docker Compose å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸš€ ç°åœ¨å¯ä»¥ç”¨äº†ï¼

### æ–¹å¼ 1: æœ¬åœ°å¼€å‘ï¼ˆä¹‹å‰çš„æ–¹å¼ï¼‰

**å¯åŠ¨æœåŠ¡**ï¼š
```bash
# Terminal 1: ETCD
etcd

# Terminal 2: Controller-Manager
cd controller-manager && go run *.go

# Terminal 3: Connect-Node
cd connect-node && go run *.go

# Terminal 4: Push-Manager
cd push-manager && go run *.go

# Terminal 5: Biz-Server
cd biz-server && go run *.go

# Terminal 6: Web Server
cd web && go run main.go
```

**è®¿é—®**ï¼š
- Web èŠå¤©å®¤: http://localhost:8086/chat.html
- WebSocket: ws://localhost:8083/connect
- API: http://localhost:8082

---

### æ–¹å¼ 2: Docker Composeï¼ˆä¸€é”®éƒ¨ç½²ï¼‰âœ¨

**å¯åŠ¨æ‰€æœ‰æœåŠ¡**ï¼š
```bash
docker-compose up --build
```

**è®¿é—®**ï¼š
- Web èŠå¤©å®¤: http://localhost:8086/chat.html
- Jaeger UI: http://localhost:16686
- Metrics: http://localhost:9090/metrics

**æŸ¥çœ‹æ—¥å¿—**ï¼š
```bash
docker-compose logs -f
```

**åœæ­¢æœåŠ¡**ï¼š
```bash
docker-compose down
```

## ğŸ“Š æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Docker Compose                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  MySQL   â”‚  â”‚  Redis   â”‚  â”‚   ETCD   â”‚  â”‚ Jaeger  â”‚â”‚
â”‚  â”‚  :3306   â”‚  â”‚  :6379   â”‚  â”‚  :2379   â”‚  â”‚ :16686  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Controller-Manager :50051                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Connect-Node â”‚  â”‚ Connect-Node â”‚  â”‚ Connect-Node â”‚ â”‚
â”‚  â”‚  1  :8083   â”‚  â”‚  2  :8084   â”‚  â”‚  3  :8085   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          Push-Manager :50053                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Biz-Server    â”‚           â”‚  Web-Server    â”‚       â”‚
â”‚  â”‚    :8082       â”‚           â”‚    :8086       â”‚       â”‚
â”‚  â”‚  (HTTP API)    â”‚           â”‚  (Web UI)      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                              â†“
    HTTP POST /broadcast        æµè§ˆå™¨è®¿é—® /chat.html
           â†“                              â†“
      å¹¿æ’­æ¶ˆæ¯                      WebSocket è¿æ¥
```

## ğŸ¨ Web èŠå¤©å®¤åŠŸèƒ½

### âœ… å·²å®ç°
- ğŸ¨ ç°ä»£åŒ– UIï¼ˆç´«è‰²æ¸å˜ä¸»é¢˜ï¼‰
- ğŸ’¬ å®æ—¶æ¶ˆæ¯æ¨é€
- ğŸ  å¤šæˆ¿é—´æ”¯æŒ
- ğŸ‘¥ å¤šç”¨æˆ·èŠå¤©
- ğŸ’“ è‡ªåŠ¨å¿ƒè·³ä¿æ´»
- ğŸ“± å“åº”å¼å¸ƒå±€
- ğŸ”„ ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹ï¼ˆæœ¬åœ°/Dockerï¼‰
- ğŸ¯ æ¶ˆæ¯æ°”æ³¡å·¦å³å¯¹é½
- â° æ˜¾ç¤ºå‘é€æ—¶é—´
- ğŸ”” ç³»ç»Ÿæ¶ˆæ¯æç¤º

### ğŸ¯ ä½¿ç”¨æµç¨‹
1. æ‰“å¼€å¤šä¸ªæµè§ˆå™¨çª—å£
2. æ¯ä¸ªçª—å£ä½¿ç”¨ä¸åŒçš„ç”¨æˆ· ID å’Œæ˜µç§°
3. åŠ å…¥ç›¸åŒçš„æˆ¿é—´ï¼ˆä¾‹å¦‚ï¼šroom-001ï¼‰
4. å¼€å§‹èŠå¤©ï¼

## ğŸ“ é…ç½®è¯´æ˜

### è‡ªåŠ¨ç¯å¢ƒæ£€æµ‹
`web/config.js` ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰ç¯å¢ƒï¼š

```javascript
const CONFIG = {
    WS_URL: window.location.hostname === 'localhost' 
        ? 'ws://localhost:8083/connect'  // æœ¬åœ°å¼€å‘
        : `ws://${window.location.hostname}:8083/connect`,  // Docker/ç”Ÿäº§
    
    API_URL: window.location.hostname === 'localhost'
        ? 'http://localhost:8082'  // æœ¬åœ°å¼€å‘
        : `http://${window.location.hostname}:8082`,  // Docker/ç”Ÿäº§
};
```

### ç«¯å£è¯´æ˜

| æœåŠ¡ | æœ¬åœ°ç«¯å£ | Docker ç«¯å£ | è¯´æ˜ |
|------|---------|-------------|------|
| Connect-Node-1 | 8083 | 8083 | WebSocket è¿æ¥ |
| Connect-Node-2 | - | 8084 | WebSocket è¿æ¥ |
| Connect-Node-3 | - | 8085 | WebSocket è¿æ¥ |
| Biz-Server | 8082 | 8082 | HTTP API |
| Web-Server | 8086 | 8086 | Web UI |

## ğŸ‰ æµ‹è¯•åœºæ™¯

### åœºæ™¯ 1: æœ¬åœ°æµ‹è¯•
```bash
# å¯åŠ¨æœ¬åœ°æœåŠ¡
cd web && go run main.go

# è®¿é—®
http://localhost:8086/chat.html
```

### åœºæ™¯ 2: Docker æµ‹è¯•
```bash
# å¯åŠ¨ Docker Compose
docker-compose up --build

# è®¿é—®
http://localhost:8086/chat.html
```

### åœºæ™¯ 3: å¤šç”¨æˆ·èŠå¤©
- æ‰“å¼€ 5 ä¸ªæµè§ˆå™¨çª—å£
- ä½¿ç”¨ä¸åŒçš„ç”¨æˆ· IDï¼ˆuser-001 åˆ° user-005ï¼‰
- ä½¿ç”¨ä¸åŒçš„æ˜µç§°ï¼ˆAlice, Bob, Charlie, David, Eveï¼‰
- åŠ å…¥åŒä¸€æˆ¿é—´ï¼ˆroom-001ï¼‰
- å¼€å§‹ç¾¤èŠï¼

## ğŸ› æ•…éšœæ’æŸ¥

### Web é¡µé¢æ— æ³•è®¿é—®
1. æ£€æŸ¥ Web Server æ˜¯å¦è¿è¡Œ
2. æ£€æŸ¥ç«¯å£ 8086 æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯

### WebSocket è¿æ¥å¤±è´¥
1. æ£€æŸ¥ Connect-Node æ˜¯å¦è¿è¡Œåœ¨ 8083 ç«¯å£
2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„ WebSocket é”™è¯¯
3. ç¡®è®¤é˜²ç«å¢™æ²¡æœ‰é˜»æ­¢è¿æ¥

### æ¶ˆæ¯å‘é€å¤±è´¥
1. æ£€æŸ¥ Biz-Server æ˜¯å¦è¿è¡Œåœ¨ 8082 ç«¯å£
2. æŸ¥çœ‹æµè§ˆå™¨ Network é¢æ¿çš„ POST è¯·æ±‚
3. æ£€æŸ¥ CORS é…ç½®

### Docker æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs biz-server
docker-compose logs web-server

# é‡å¯æœåŠ¡
docker-compose restart biz-server
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Docker éƒ¨ç½²æŒ‡å—](./DOCKER_DEPLOYMENT.md)
- [Web å®¢æˆ·ç«¯æ–‡æ¡£](./web/README.md)
- [ç³»ç»Ÿæ¶æ„](./ARCHITECTURE.md)

## ğŸŠ æ€»ç»“

ç°åœ¨æ‚¨æœ‰ä¸¤ç§æ–¹å¼è¿è¡Œç³»ç»Ÿï¼š

1. **æœ¬åœ°å¼€å‘**ï¼šé€ä¸ªå¯åŠ¨æœåŠ¡ï¼Œæ–¹ä¾¿è°ƒè¯•
2. **Docker Compose**ï¼šä¸€é”®éƒ¨ç½²ï¼Œæ¥è¿‘ç”Ÿäº§ç¯å¢ƒ

ä¸¤ç§æ–¹å¼çš„ Web èŠå¤©å®¤éƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œé…ç½®ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é€‚é…ï¼ğŸš€


